<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì§ Subir Videos + Buscador Web Azure</title>
    <style>
        /* ===== ESTILOS EXISTENTES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #0078d4;
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        /* ===== PANELES DE FUNCIONALIDAD ===== */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(550px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .feature-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .panel-title {
            color: #0078d4;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-subtitle {
            color: #666;
            margin-bottom: 25px;
            font-size: 1rem;
        }
        
        /* ===== ESTILOS UPLOADER (EXISTENTES) ===== */
        .file-input-wrapper {
            position: relative;
            margin: 20px 0;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 2;
        }
        
        .file-label {
            display: block;
            padding: 30px 20px;
            border: 3px dashed #0078d4;
            border-radius: 15px;
            background: #f8fafc;
            transition: all 0.3s;
            color: #0078d4;
            font-weight: 600;
            font-size: 1rem;
            text-align: center;
        }
        
        .file-label:hover {
            background: #e3f2fd;
            border-color: #005a9e;
        }
        
        .file-label.dragover {
            background: #d4edda;
            border-color: #28a745;
        }
        
        .upload-button {
            background: linear-gradient(90deg, #0078d4, #005a9e);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 15px;
        }
        
        .upload-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 120, 212, 0.3);
        }
        
        .upload-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* ===== ESTILOS BUSCADOR ===== */
        .search-container {
            margin: 25px 0;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .search-input {
            flex-grow: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 3px rgba(0, 120, 212, 0.1);
        }
        
        .search-button {
            background: linear-gradient(90deg, #28a745, #20c997);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .search-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .quick-search-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .quick-search-btn {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .quick-search-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }
        
        /* ===== RESULTADOS DE B√öSQUEDA ===== */
        .results-container {
            margin-top: 25px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .result-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #0078d4;
            transition: all 0.3s;
        }
        
        .result-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #005a9e;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .result-snippet {
            color: #495057;
            margin-bottom: 10px;
            line-height: 1.5;
        }
        
        .result-url {
            color: #6c757d;
            font-size: 0.85rem;
            display: block;
            margin-bottom: 8px;
            word-break: break-all;
        }
        
        .result-source {
            display: inline-block;
            background: #e3f2fd;
            color: #005a9e;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* ===== MENSAJES Y PROGRESO ===== */
        .message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .info-box {
            margin-top: 20px;
            padding: 15px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            color: #856404;
            font-size: 0.85rem;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* ===== NAVEGACI√ìN ===== */
        .navigation {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid #dee2e6;
        }
        
        .nav-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 25px;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-videos {
            background: #0078d4;
            color: white;
        }
        
        .nav-search {
            background: #28a745;
            color: white;
        }
        
        .nav-viewer {
            background: #9c27b0;
            color: white;
        }
        
        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .feature-panel {
                min-width: 100%;
            }
        }
        
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
                flex-direction: column;
            }
            
            .search-box {
                flex-direction: column;
            }
            
            .quick-search-buttons {
                justify-content: center;
            }
            
            .navigation {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-button {
                width: 100%;
                justify-content: center;
            }
        }
        
        /* ===== ANIMACIONES ===== */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER PRINCIPAL -->
        <div class="header fade-in">
            <h1>
                <span>üì§</span> Azure Storage Uploader
                <span>+</span>
                <span>üîç</span> Web Search
            </h1>
            <p>Sube videos a Azure Storage y busca informaci√≥n en Internet usando servicios gratuitos</p>
        </div>

        <!-- GRID DE FUNCIONALIDADES -->
        <div class="features-grid">
            <!-- PANEL 1: UPLOAD DE VIDEOS -->
            <div class="feature-panel fade-in" style="animation-delay: 0.1s">
                <h2 class="panel-title">
                    <span>üì§</span> Subir Videos a Azure
                </h2>
                <p class="panel-subtitle">
                    Sube videos directamente al contenedor Azure Storage con SAS token
                </p>
                
                <div class="info-box">
                    <strong>üîê Permisos activos:</strong> Lectura ‚úÖ | Escritura ‚úÖ | Lista ‚úÖ | Adici√≥n ‚úÖ<br>
                    <strong>‚è∞ Expira:</strong> 23/01/2026 08:55 AM<br>
                    <strong>üìÅ Contenedor:</strong> multimedia
                </div>
                
                <div class="file-input-wrapper">
                    <input type="file" id="fileInput" class="file-input" accept="video/*,.mp4,.avi,.mov,.wmv">
                    <label for="fileInput" id="fileLabel" class="file-label">
                        üìÅ Haz clic aqu√≠ o arrastra un video<br>
                        <small>(L√≠mite: 100MB, Formatos: MP4, AVI, MOV, WMV)</small>
                    </label>
                </div>
                
                <div id="fileInfo" class="info-box" style="display: none;">
                    Archivo seleccionado: <strong id="fileName"></strong><br>
                    Tama√±o: <strong id="fileSize"></strong>
                </div>
                
                <button id="uploadButton" class="upload-button" disabled>
                    ‚è´ Subir Video a Azure
                </button>
                
                <div id="uploadProgress" class="progress-container">
                    <div>Subiendo: <span id="uploadProgressText">0%</span></div>
                    <div class="progress-bar">
                        <div id="uploadProgressFill" class="progress-fill"></div>
                    </div>
                </div>
                
                <div id="uploadSuccess" class="message success"></div>
                <div id="uploadError" class="message error"></div>
            </div>

            <!-- PANEL 2: BUSCADOR WEB -->
            <div class="feature-panel fade-in" style="animation-delay: 0.2s">
                <h2 class="panel-title">
                    <span>üîç</span> Buscador Web Gratuito
                </h2>
                <p class="panel-subtitle">
                    Busca informaci√≥n en Internet usando Bing Search API (1,000 b√∫squedas/mes gratis)
                </p>
                
                <div class="search-container">
                    <div class="search-box">
                        <input 
                            type="text" 
                            id="searchInput" 
                            class="search-input" 
                            placeholder="¬øQu√© quieres buscar? (ej: noticias de IA, tutoriales Azure...)"
                            autocomplete="off"
                        >
                        <button id="searchButton" class="search-button">
                            üîç Buscar
                        </button>
                    </div>
                    
                    <div class="quick-search-buttons">
                        <button class="quick-search-btn" onclick="quickSearch('Azure servicios gratuitos 2024')">
                            üÜì Azure Gratis
                        </button>
                        <button class="quick-search-btn" onclick="quickSearch('Noticias de inteligencia artificial')">
                            ü§ñ Noticias IA
                        </button>
                        <button class="quick-search-btn" onclick="quickSearch('Tutorial Azure Storage Blob')">
                            üìö Tutorial Azure
                        </button>
                        <button class="quick-search-btn" onclick="quickSearch('Microsoft Copilot novedades')">
                            ‚ö° Microsoft Copilot
                        </button>
                    </div>
                </div>
                
                <div id="searchStats" class="info-box" style="display: none;">
                    Buscando informaci√≥n en la web...
                </div>
                
                <div id="searchProgress" class="progress-container" style="display: none;">
                    <div>Procesando: <span id="searchProgressText">0%</span></div>
                    <div class="progress-bar">
                        <div id="searchProgressFill" class="progress-fill"></div>
                    </div>
                </div>
                
                <div id="searchResults" class="results-container"></div>
                
                <div id="searchSuccess" class="message success"></div>
                <div id="searchError" class="message error"></div>
                
                <div class="info-box" style="margin-top: 20px;">
                    <strong>‚ÑπÔ∏è Fuentes gratuitas usadas:</strong><br>
                    ‚Ä¢ Bing Search API (1,000 b√∫squedas/mes gratis)<br>
                    ‚Ä¢ DuckDuckGo (sin l√≠mites via web scraping)<br>
                    ‚Ä¢ Cache local para reducir llamadas API
                </div>
            </div>
        </div>

        <!-- NAVEGACI√ìN -->
        <div class="navigation fade-in" style="animation-delay: 0.3s">
            <a href="index.html" class="nav-button nav-videos">
                üé¨ Ver Videos Subidos
            </a>
            <a href="buscar-productos.html" class="nav-button nav-search">
                üîç Buscar Productos
            </a>
            <a href="blob-viewer.html" class="nav-button nav-viewer">
                üìä Visualizador Azure Blob
            </a>
        </div>
    </div>

    <script>
        // ================================================
        // CONFIGURACI√ìN UPLOAD - TU URL SAS
        // ================================================
        const SAS_URL = "https://almacenamientoivan.blob.core.windows.net/multimedia?sp=racwd&st=2025-12-20T01:50:55Z&se=2025-12-20T10:05:55Z&spr=https&sv=2024-11-04&sr=c&sig=zabjdZrYLp9aKzp2ZJDwTdsjQMcvslVnXN5YVqMKh%2FM%3D";
        
        // ================================================
        // CONFIGURACI√ìN BUSCADOR - API GRATUITAS
        // ================================================
        const BING_API_KEY = "TU_CLAVE_BING_API"; // Reemplaza con tu clave
        const BING_ENDPOINT = "https://api.bing.microsoft.com/v7.0/search";
        
        // Cache simple en localStorage
        const SEARCH_CACHE = {
            set: (key, data, ttl = 3600000) => { // 1 hora por defecto
                const item = {
                    data: data,
                    expiry: Date.now() + ttl
                };
                localStorage.setItem(`search_${key}`, JSON.stringify(item));
            },
            get: (key) => {
                const itemStr = localStorage.getItem(`search_${key}`);
                if (!itemStr) return null;
                
                const item = JSON.parse(itemStr);
                if (Date.now() > item.expiry) {
                    localStorage.removeItem(`search_${key}`);
                    return null;
                }
                return item.data;
            }
        };
        
        // ================================================
        // FUNCIONALIDAD UPLOAD (EXISTENTE)
        // ================================================
        const uploadElements = {
            fileInput: document.getElementById('fileInput'),
            fileLabel: document.getElementById('fileLabel'),
            uploadButton: document.getElementById('uploadButton'),
            uploadProgress: document.getElementById('uploadProgress'),
            uploadProgressFill: document.getElementById('uploadProgressFill'),
            uploadProgressText: document.getElementById('uploadProgressText'),
            uploadSuccess: document.getElementById('uploadSuccess'),
            uploadError: document.getElementById('uploadError'),
            fileInfo: document.getElementById('fileInfo'),
            fileName: document.getElementById('fileName'),
            fileSize: document.getElementById('fileSize')
        };
        
        let selectedFile = null;
        
        // Eventos de upload (manteniendo tu l√≥gica original)
        uploadElements.fileInput.addEventListener('change', handleFileSelect);
        
        function handleFileSelect(e) {
            selectedFile = e.target.files[0];
            if (selectedFile) {
                // Validaciones
                if (selectedFile.size > 100 * 1024 * 1024) {
                    showUploadError('El archivo es demasiado grande. L√≠mite: 100MB');
                    resetUploadForm();
                    return;
                }
                
                const validTypes = ['video/mp4', 'video/avi', 'video/quicktime', 'video/x-ms-wmv'];
                if (!validTypes.includes(selectedFile.type) && !selectedFile.name.match(/\.(mp4|avi|mov|wmv)$/i)) {
                    showUploadError('Formato no v√°lido. Usa MP4, AVI, MOV o WMV');
                    resetUploadForm();
                    return;
                }
                
                // Mostrar informaci√≥n
                uploadElements.fileName.textContent = selectedFile.name;
                uploadElements.fileSize.textContent = formatBytes(selectedFile.size);
                uploadElements.fileInfo.style.display = 'block';
                
                // Habilitar bot√≥n
                uploadElements.uploadButton.disabled = false;
                uploadElements.fileLabel.innerHTML = `‚úÖ ${selectedFile.name}<br><small>Haz clic para cambiar</small>`;
                uploadElements.fileLabel.style.borderColor = '#28a745';
                uploadElements.fileLabel.style.background = '#d4edda';
            }
        }
        
        // Drag and drop para upload
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadElements.fileLabel.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            uploadElements.fileLabel.addEventListener(eventName, () => {
                uploadElements.fileLabel.classList.add('dragover');
            }, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            uploadElements.fileLabel.addEventListener(eventName, () => {
                uploadElements.fileLabel.classList.remove('dragover');
            }, false);
        });
        
        uploadElements.fileLabel.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadElements.fileInput.files = files;
                uploadElements.fileInput.dispatchEvent(new Event('change'));
            }
        });
        
        // Subir archivo
        uploadElements.uploadButton.addEventListener('click', uploadFile);
        
        async function uploadFile() {
            if (!selectedFile) return;
            
            // Verificar SAS
            const urlParams = new URLSearchParams(SAS_URL.split('?')[1]);
            const expiryTime = new Date(urlParams.get('se'));
            if (new Date() > expiryTime) {
                showUploadError('El enlace SAS ha expirado. Solicita uno nuevo.');
                return;
            }
            
            // Deshabilitar interfaz
            uploadElements.uploadButton.disabled = true;
            uploadElements.fileInput.disabled = true;
            uploadElements.uploadProgress.style.display = 'block';
            uploadElements.uploadProgressFill.style.width = '0%';
            uploadElements.uploadProgressText.textContent = '0%';
            
            try {
                // Nombre √∫nico
                const timestamp = Date.now();
                const randomId = Math.random().toString(36).substring(2, 8);
                const safeName = selectedFile.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                const blobName = `${timestamp}_${randomId}_${safeName}`;
                
                // URL completa
                const baseUrl = SAS_URL.split('?')[0];
                const queryParams = SAS_URL.split('?')[1];
                const uploadUrl = `${baseUrl}/${encodeURIComponent(blobName)}?${queryParams}`;
                
                // XMLHttpRequest con progreso
                const xhr = new XMLHttpRequest();
                
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percentComplete = Math.round((e.loaded / e.total) * 100);
                        uploadElements.uploadProgressFill.style.width = `${percentComplete}%`;
                        uploadElements.uploadProgressText.textContent = `${percentComplete}%`;
                        uploadElements.uploadButton.innerHTML = `‚è´ Subiendo... ${percentComplete}%`;
                    }
                });
                
                xhr.addEventListener('load', () => {
                    if (xhr.status === 201) {
                        showUploadSuccess(`
                            ‚úÖ <strong>Video subido exitosamente!</strong><br><br>
                            üìÅ <strong>Nombre:</strong> ${blobName}<br>
                            üíæ <strong>Tama√±o:</strong> ${formatBytes(selectedFile.size)}<br>
                            üîó <strong>URL:</strong> <a href="${baseUrl}/${encodeURIComponent(blobName)}" target="_blank">Ver en Azure</a>
                        `);
                        resetUploadForm();
                    } else {
                        showUploadError(`Error ${xhr.status}: ${xhr.statusText}`);
                        uploadElements.uploadButton.disabled = false;
                        uploadElements.fileInput.disabled = false;
                        uploadElements.uploadButton.innerHTML = '‚è´ Subir Video a Azure';
                    }
                    uploadElements.uploadProgress.style.display = 'none';
                });
                
                xhr.addEventListener('error', () => {
                    showUploadError('Error de conexi√≥n. Verifica tu internet.');
                    uploadElements.uploadButton.disabled = false;
                    uploadElements.fileInput.disabled = false;
                    uploadElements.uploadProgress.style.display = 'none';
                    uploadElements.uploadButton.innerHTML = '‚è´ Subir Video a Azure';
                });
                
                // Enviar
                xhr.open('PUT', uploadUrl);
                xhr.setRequestHeader('x-ms-blob-type', 'BlockBlob');
                xhr.setRequestHeader('Content-Type', selectedFile.type || 'video/mp4');
                xhr.setRequestHeader('x-ms-blob-content-type', selectedFile.type || 'video/mp4');
                xhr.send(selectedFile);
                
            } catch (error) {
                console.error('Upload error:', error);
                showUploadError(`Error: ${error.message}`);
                uploadElements.uploadButton.disabled = false;
                uploadElements.fileInput.disabled = false;
                uploadElements.uploadProgress.style.display = 'none';
                uploadElements.uploadButton.innerHTML = '‚è´ Subir Video a Azure';
            }
        }
        
        // Funciones auxiliares upload
        function showUploadSuccess(message) {
            uploadElements.uploadSuccess.innerHTML = message;
            uploadElements.uploadSuccess.style.display = 'block';
            uploadElements.uploadError.style.display = 'none';
            setTimeout(() => uploadElements.uploadSuccess.style.display = 'none', 10000);
        }
        
        function showUploadError(message) {
            uploadElements.uploadError.innerHTML = message;
            uploadElements.uploadError.style.display = 'block';
            uploadElements.uploadSuccess.style.display = 'none';
            setTimeout(() => uploadElements.uploadError.style.display = 'none', 8000);
        }
        
        function resetUploadForm() {
            uploadElements.fileInput.value = '';
            selectedFile = null;
            uploadElements.uploadButton.disabled = true;
            uploadElements.fileInput.disabled = false;
            uploadElements.fileInfo.style.display = 'none';
            uploadElements.fileLabel.innerHTML = 'üìÅ Haz clic aqu√≠ o arrastra un video<br><small>(L√≠mite: 100MB, Formatos: MP4, AVI, MOV, WMV)</small>';
            uploadElements.fileLabel.style.borderColor = '#0078d4';
            uploadElements.fileLabel.style.background = '#f8fafc';
            uploadElements.uploadButton.innerHTML = '‚è´ Subir Video a Azure';
        }
        
        // ================================================
        // FUNCIONALIDAD BUSCADOR (NUEVA)
        // ================================================
        const searchElements = {
            searchInput: document.getElementById('searchInput'),
            searchButton: document.getElementById('searchButton'),
            searchStats: document.getElementById('searchStats'),
            searchProgress: document.getElementById('searchProgress'),
            searchProgressFill: document.getElementById('searchProgressFill'),
            searchProgressText: document.getElementById('searchProgressText'),
            searchResults: document.getElementById('searchResults'),
            searchSuccess: document.getElementById('searchSuccess'),
            searchError: document.getElementById('searchError')
        };
        
        // Eventos del buscador
        searchElements.searchButton.addEventListener('click', performSearch);
        searchElements.searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') performSearch();
        });
        
        async function performSearch() {
            const query = searchElements.searchInput.value.trim();
            if (!query) {
                showSearchError('Por favor, escribe algo para buscar');
                return;
            }
            
            // Mostrar carga
            searchElements.searchStats.style.display = 'block';
            searchElements.searchStats.innerHTML = 'üîç Buscando en la web...';
            searchElements.searchProgress.style.display = 'block';
            searchElements.searchProgressFill.style.width = '10%';
            searchElements.searchProgressText.textContent = '10%';
            searchElements.searchResults.innerHTML = '';
            searchElements.searchButton.disabled = true;
            
            try {
                // Verificar cache primero
                const cachedResults = SEARCH_CACHE.get(query);
                if (cachedResults) {
                    searchElements.searchStats.innerHTML = '‚ö° Mostrando resultados de cache...';
                    searchElements.searchProgressFill.style.width = '100%';
                    searchElements.searchProgressText.textContent = '100%';
                    setTimeout(() => displaySearchResults(cachedResults, 'cache'), 500);
                    return;
                }
                
                // Buscar con Bing API (gratis)
                searchElements.searchProgressFill.style.width = '30%';
                searchElements.searchProgressText.textContent = '30%';
                
                const results = await searchWithBing(query);
                
                // Si Bing falla, intentar con DuckDuckGo
                if (results.length === 0) {
                    searchElements.searchStats.innerHTML = 'üîÑ Intentando con DuckDuckGo...';
                    searchElements.searchProgressFill.style.width = '60%';
                    searchElements.searchProgressText.textContent = '60%';
                    
                    const ddgResults = await searchWithDuckDuckGo(query);
                    if (ddgResults.length > 0) {
                        results.push(...ddgResults);
                    }
                }
                
                // Guardar en cache
                if (results.length > 0) {
                    SEARCH_CACHE.set(query, results);
                }
                
                // Mostrar resultados
                searchElements.searchProgressFill.style.width = '100%';
                searchElements.searchProgressText.textContent = '100%';
                displaySearchResults(results, 'web');
                
            } catch (error) {
                console.error('Search error:', error);
                showSearchError(`Error en la b√∫squeda: ${error.message}`);
            } finally {
                searchElements.searchProgress.style.display = 'none';
                searchElements.searchButton.disabled = false;
                searchElements.searchStats.innerHTML = '';
            }
        }
        
        async function searchWithBing(query, numResults = 8) {
            if (!BING_API_KEY || BING_API_KEY === "TU_CLAVE_BING_API") {
                console.warn('Bing API key no configurada');
                return [];
            }
            
            try {
                const headers = { "Ocp-Apim-Subscription-Key": BING_API_KEY };
                const params = {
                    "q": query,
                    "count": numResults,
                    "responseFilter": "Webpages",
                    "textDecorations": true,
                    "textFormat": "HTML",
                    "safeSearch": "Moderate",
                    "setLang": "es"
                };
                
                const response = await fetch(`${BING_ENDPOINT}?${new URLSearchParams(params)}`, { headers });
                
                if (!response.ok) {
                    throw new Error(`Bing API error: ${response.status}`);
                }
                
                const data = await response.json();
                const results = [];
                
                if (data.webPages && data.webPages.value) {
                    data.webPages.value.forEach(item => {
                        results.push({
                            title: item.name || '',
                            url: item.url || '',
                            snippet: item.snippet || '',
                            source: 'bing'
                        });
                    });
                }
                
                return results;
            } catch (error) {
                console.error('Bing search error:', error);
                return [];
            }
        }
        
        async function searchWithDuckDuckGo(query, numResults = 5) {
            try {
                // Usar DuckDuckGo via DuckDuckGo Instant Answer API (gratis)
                const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1`);
                const data = await response.json();
                
                const results = [];
                
                // Extraer resultados principales
                if (data.AbstractText) {
                    results.push({
                        title: data.Heading || query,
                        url: data.AbstractURL || '',
                        snippet: data.AbstractText,
                        source: 'duckduckgo'
                    });
                }
                
                // Extraer enlaces relacionados
                if (data.RelatedTopics) {
                    data.RelatedTopics.slice(0, numResults - 1).forEach(topic => {
                        if (topic.Text && topic.FirstURL) {
                            results.push({
                                title: topic.Text.split(' - ')[0] || 'Resultado',
                                url: topic.FirstURL,
                                snippet: topic.Text,
                                source: 'duckduckgo'
                            });
                        }
                    });
                }
                
                return results;
            } catch (error) {
                console.error('DuckDuckGo search error:', error);
                return [];
            }
        }
        
        function displaySearchResults(results, source) {
            searchElements.searchStats.innerHTML = `‚úÖ Encontrados ${results.length} resultados (fuente: ${source})`;
            searchElements.searchResults.innerHTML = '';
            
            if (results.length === 0) {
                searchElements.searchResults.innerHTML = `
                    <div class="result-item">
                        <div class="result-title">No se encontraron resultados</div>
                        <div class="result-snippet">Intenta con t√©rminos de b√∫squeda diferentes.</div>
                    </div>
                `;
                return;
            }
            
            results.forEach((result, index) => {
                const resultElement = document.createElement('div');
                resultElement.className = 'result-item fade-in';
                resultElement.style.animationDelay = `${index * 0.1}s`;
                
                resultElement.innerHTML = `
                    <div class="result-title">
                        <span>${index + 1}. ${result.title}</span>
                        <span class="result-source">${result.source}</span>
                    </div>
                    <div class="result-snippet">${result.snippet}</div>
                    <a href="${result.url}" target="_blank" class="result-url">${result.url}</a>
                `;
                
                searchElements.searchResults.appendChild(resultElement);
            });
            
            // Mostrar √©xito
            showSearchSuccess(`B√∫squeda completada. ${results.length} resultados encontrados.`);
        }
        
        // B√∫squeda r√°pida
        function quickSearch(query) {
            searchElements.searchInput.value = query;
            performSearch();
        }
        
        // Funciones auxiliares buscador
        function showSearchSuccess(message) {
            searchElements.searchSuccess.innerHTML = message;
            searchElements.searchSuccess.style.display = 'block';
            searchElements.searchError.style.display = 'none';
            setTimeout(() => searchElements.searchSuccess.style.display = 'none', 5000);
        }
        
        function showSearchError(message) {
            searchElements.searchError.innerHTML = message;
            searchElements.searchError.style.display = 'block';
            searchElements.searchSuccess.style.display = 'none';
            setTimeout(() => searchElements.searchError.style.display = 'none', 8000);
        }
        
        // ================================================
        // FUNCIONES COMPARTIDAS
        // ================================================
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(decimals)) + ' ' + sizes[i];
        }
        
        // Validar SAS al cargar
        document.addEventListener('DOMContentLoaded', () => {
            console.log('P√°gina cargada - Uploader + Buscador');
            
            // Verificar expiraci√≥n SAS
            const urlParams = new URLSearchParams(SAS_URL.split('?')[1]);
            const expiryTime = new Date(urlParams.get('se'));
            const now = new Date();
            
            if (now > expiryTime) {
                showUploadError('‚ö†Ô∏è El enlace SAS ha expirado. Solicita uno nuevo.');
            } else {
                const hoursLeft = Math.round((expiryTime - now) / (1000 * 60 * 60));
                console.log(`SAS v√°lido por: ${hoursLeft} horas`);
            }
            
            // Verificar API Key de Bing
            if (!BING_API_KEY || BING_API_KEY === "TU_CLAVE_BING_API") {
                console.warn('Bing API Key no configurada. Usa DuckDuckGo como fallback.');
                searchElements.searchError.innerHTML = '‚ö†Ô∏è Configura tu Bing API Key para mejores resultados';
                searchElements.searchError.style.display = 'block';
                setTimeout(() => searchElements.searchError.style.display = 'none', 5000);
            }
        });
    </script>
</body>
</html>
